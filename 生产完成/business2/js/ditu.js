"use strict";function setAnchor(a,b){var c=27*a.index;if(1==b){var d=new qq.maps.Point(10,30),e=new qq.maps.Point(c,0),f=new qq.maps.Size(27,33),g=new qq.maps.MarkerImage("./img/marker10.png",f,e,d);a.setIcon(g)}else{var d=new qq.maps.Point(10,30),e=new qq.maps.Point(c,35),f=new qq.maps.Size(27,33),g=new qq.maps.MarkerImage("./img/marker10.png",f,e,d);a.setIcon(g)}}function setCurrent(a,b,c){c?each(markerArray,function(a,c){a==b?(setAnchor(c,!1),c.setZIndex(10)):c.isClicked||(setAnchor(c,!0),c.setZIndex(9))}):each(markerArray,function(a,c){a==b?c.div.style.background="#DBE4F2":c.div.isClicked||(c.div.style.background="#fff")})}function setFlagClicked(a,b){each(markerArray,function(a,c){if(a==b){c.isClicked=!0,c.div.isClicked=!0;var d=(c.div.children[1].innerHTML.toString(),c.getPosition());document.getElementById("poi_cur").value=d.getLat().toFixed(6)+","+d.getLng().toFixed(6)}else c.isClicked=!1,c.div.isClicked=!1})}function each(a,b){for(var c=0,d=a.length;c<d;c++)b.call(a[c],c,a[c])}var container=document.getElementById("container"),dsf_dsf="",map=new qq.maps.Map(container,{zoom:10}),label=new qq.maps.Label({map:map,offset:new qq.maps.Size(15,-12),draggable:!1,clickable:!1}),markerArray=[],curCity=document.getElementById("cur_city"),btnSearch=document.getElementById("btn_search"),bside=document.getElementById("bside_left"),url,query_city,cityservice=new qq.maps.CityService({complete:function(a){dsf_dsf="深圳市",map.setCenter(a.detail.latLng)}});cityservice.searchLocalCity(),map.setOptions({draggableCursor:"crosshair"}),$(container).mouseenter(function(){label.setMap(map)}),$(container).mouseleave(function(){label.setMap(null)}),qq.maps.event.addListener(map,"mousemove",function(a){var b=a.latLng;label.setPosition(b),label.setContent(b.getLat().toFixed(6)+","+b.getLng().toFixed(6))});var url3;qq.maps.event.addListener(map,"click",function(a){document.getElementById("poi_cur").value=a.latLng.getLat().toFixed(6)+","+a.latLng.getLng().toFixed(6),url3=encodeURI("http://apis.map.qq.com/ws/geocoder/v1/?location="+a.latLng.getLat()+","+a.latLng.getLng()+"&key=K76BZ-W3O2Q-RFL5S-GXOPR-3ARIT-6KFE5&output=jsonp&&callback=?"),$.getJSON(url3,function(a){void 0!=a.result?document.getElementById("addr_cur").value=a.result.address:document.getElementById("addr_cur").value=""})}),qq.maps.event.addListener(map,"zoom_changed",function(){document.getElementById("level").innerHTML="当前缩放等级："+map.getZoom()});var listener_arr=[],isNoValue=!1;qq.maps.event.addDomListener(btnSearch,"click",function(){for(var a=this.parentNode.getElementsByTagName("input")[0].value,b=new qq.maps.LatLngBounds,c=0,d=listener_arr.length;c<d;c++)qq.maps.event.removeListener(listener_arr[c]);listener_arr.length=0,query_city="深圳市",url=encodeURI("http://apis.map.qq.com/ws/place/v1/search?keyword="+a+"&boundary=region("+query_city+",0)&page_size=9&page_index=1&key=6NIBZ-YGFK4-P2DUR-X7NU5-246HF-HXBIA&output=jsonp&&callback=?"),$.getJSON(url,function(a){if(a.count)isNoValue=!1,bside.innerHTML="",each(markerArray,function(a,b){b.setMap(null)}),markerArray.length=0,each(a.data,function(a,c){var d=new qq.maps.LatLng(c.location.lat,c.location.lng);b.extend(d);var e=new qq.maps.Marker({map:map,position:d,zIndex:10});e.index=a,e.isClicked=!1,setAnchor(e,!0),markerArray.push(e);var f=qq.maps.event.addDomListener(e,"mouseover",function(){var a=this.index;setCurrent(markerArray,a,!1),setCurrent(markerArray,a,!0),label.setContent(this.position.getLat().toFixed(6)+","+this.position.getLng().toFixed(6)),label.setPosition(this.position),label.setOptions({offset:new qq.maps.Size(15,-20)})});listener_arr.push(f);var g=qq.maps.event.addDomListener(e,"mouseout",function(){var a=this.index;setCurrent(markerArray,a,!1),setCurrent(markerArray,a,!0),label.setOptions({offset:new qq.maps.Size(15,-12)})});listener_arr.push(g);var h=qq.maps.event.addDomListener(e,"click",function(){var a=this.index;setFlagClicked(markerArray,a),setCurrent(markerArray,a,!1),setCurrent(markerArray,a,!0),document.getElementById("addr_cur").value=bside.childNodes[a].childNodes[1].childNodes[1].innerHTML.substring(3)});listener_arr.push(h),map.fitBounds(b);var i=document.createElement("div");i.className="info_list";var j=document.createElement("div"),k=-54-17*a;j.style.cssText="width:17px;height:17px;margin:3px 3px 0px 0px;float:left;background:url(./img/marker_n.png) "+k+"px 0px",i.appendChild(j);var l=document.createElement("div");l.style.cssText="width:200px;float:left;",i.appendChild(l);var m=document.createElement("p");m.style.cssText="margin:0px;color:#0000CC",m.innerHTML=c.title,l.appendChild(m);var n=document.createElement("p");if(n.style.cssText="margin:0px;",n.innerHTML="地址："+c.address,l.appendChild(n),void 0!=c.tel){var o=document.createElement("p");o.style.cssText="margin:0px;",o.innerHTML="电话："+c.tel,l.appendChild(o)}var p=document.createElement("p");p.style.cssText="margin:0px;",p.innerHTML="坐标："+c.location.lat.toFixed(6)+"，"+c.location.lng.toFixed(6),l.appendChild(p),bside.appendChild(i),i.style.height=l.offsetHeight+"px",i.isClicked=!1,i.index=a,e.div=i,i.marker=e}),$("#bside_left").delegate(".info_list","mouseover",function(a){var b=this.index;setCurrent(markerArray,b,!1),setCurrent(markerArray,b,!0)}),$("#bside_left").delegate(".info_list","mouseout",function(){each(markerArray,function(a,b){b.isClicked||(setAnchor(b,!0),b.div.style.background="#fff")})}),$("#bside_left").delegate(".info_list","click",function(a){var b=this.index;setFlagClicked(markerArray,b),setCurrent(markerArray,b,!1),setCurrent(markerArray,b,!0),map.setCenter(markerArray[b].position),document.getElementById("addr_cur").value=this.childNodes[1].childNodes[1].innerHTML.substring(3)});else{bside.innerHTML="",each(markerArray,function(a,b){b.setMap(null)}),markerArray.length=0;var c=document.createElement("div");c.id="no_value",c.innerHTML="对不起，没有搜索到您要找的结果!",bside.appendChild(c),isNoValue=!0}})}),btnSearch.onmousedown=function(){this.className="btn_active"},btnSearch.onmouseup=function(){this.className="btn"};var url2;city.onclick=function(a){var a=a||window.event,b=a.target||a.srcElement;"close"==b.className&&(city.style.display="none"),"city_name"==b.className&&(dsf_dsf=b.innerHTML,url2=encodeURI("http://apis.map.qq.com/ws/geocoder/v1/?region="+dsf_dsf+"&address="+dsf_dsf+"&key=K76BZ-W3O2Q-RFL5S-GXOPR-3ARIT-6KFE5&output=jsonp&&callback=?"),$.getJSON(url2,function(a){map.setCenter(new qq.maps.LatLng(a.result.location.lat,a.result.location.lng)),map.setZoom(10)}),city.style.display="none")};var url4;$(".search_t").autocomplete({source:function(a,b){url4=encodeURI("http://apis.map.qq.com/ws/place/v1/suggestion/?keyword="+a.term+"&region="+dsf_dsf+"&key=6NIBZ-YGFK4-P2DUR-X7NU5-246HF-HXBIA&output=jsonp&&callback=?"),$.getJSON(url4,function(a){b($.map(a.data,function(a){return{label:a.title}}))})}});
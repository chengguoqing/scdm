!function(a,b){var c=document.createElement("div"),d=function(b){this.options=a.extend(!0,{id:"__MUI_PREVIEWIMAGE",zoom:!0,header:'<span class="mui-preview-indicator"></span>',footer:""},b||{}),this.init(),this.initEvent()},e=d.prototype;e.init=function(){var b=this.options,d=document.getElementById(this.options.id);d||(c.innerHTML='<div id="{{id}}" class="mui-slider mui-preview-image mui-fullscreen"><div class="mui-preview-header">{{header}}</div><div class="mui-slider-group"></div><div class="mui-preview-footer mui-hidden">{{footer}}</div><div class="mui-preview-loading"><span class="mui-spinner mui-spinner-white"></span></div></div>'.replace(/\{\{id\}\}/g,this.options.id).replace("{{header}}",b.header).replace("{{footer}}",b.footer),document.body.appendChild(c.firstElementChild),d=document.getElementById(this.options.id)),this.element=d,this.scroller=this.element.querySelector(a.classSelector(".slider-group")),this.indicator=this.element.querySelector(a.classSelector(".preview-indicator")),this.loader=this.element.querySelector(a.classSelector(".preview-loading")),b.footer&&this.element.querySelector(a.classSelector(".preview-footer")).classList.remove(a.className("hidden")),this.addImages()},e.initEvent=function(){var b=this;a(document.body).on("tap","img[data-preview-src]",function(){return!b.isAnimationing()&&(b.open(this),!1)});var c=null,d=function(){!c&&(c=a.later(function(){b.isInAnimation=!0,b.loader.removeEventListener("tap",d),b.scroller.removeEventListener("tap",d),b.close()},300))};this.scroller.addEventListener("doubletap",function(){c&&(c.cancel(),c=null)}),this.element.addEventListener("webkitAnimationEnd",function(){b.element.classList.contains(a.className("preview-out"))?(b.element.style.display="none",b.element.classList.remove(a.className("preview-out")),c=null):(b.loader.addEventListener("tap",d),b.scroller.addEventListener("tap",d)),b.isInAnimation=!1}),this.element.addEventListener("slide",function(c){if(b.options.zoom){var d=b.element.querySelector(".mui-zoom-wrapper:nth-child("+(b.lastIndex+1)+")");d&&a(d).zoom().setZoom(1)}var e=c.detail.slideNumber;b.lastIndex=e,b.indicator&&(b.indicator.innerText=e+1+"/"+b.currentGroup.length),b._loadItem(e)})},e.isAnimationing=function(){return!!this.isInAnimation||(this.isInAnimation=!0,!1)},e.addImages=function(a,b){this.groups={};var c=[];if(c=a?"__DEFAULT"===a?document.querySelectorAll("img[data-preview-src]:not([data-preview-group])"):document.querySelectorAll("img[data-preview-src][data-preview-group='"+a+"']"):document.querySelectorAll("img[data-preview-src]"),c.length)for(var d=0,e=c.length;d<e;d++)this.addImage(c[d])},e.addImage=function(a){var b=a.getAttribute("data-preview-group");b=b||"__DEFAULT",this.groups[b]||(this.groups[b]=[]);var c=a.getAttribute("src");if(a.__mui_img_data&&a.__mui_img_data.src===c)this.groups[b].push(a.__mui_img_data);else{var d=a.getAttribute("data-preview-src");d||(d=c);var e={src:c,lazyload:c===d?"":d,loaded:c===d,sWidth:0,sHeight:0,sTop:0,sLeft:0,sScale:1,el:a};this.groups[b].push(e),a.__mui_img_data=e}},e.empty=function(){this.scroller.innerHTML=""},e._initImgData=function(c,d){if(!c.sWidth){var e=c.el;c.sWidth=e.offsetWidth,c.sHeight=e.offsetHeight;var f=a.offset(e);c.sTop=f.top,c.sLeft=f.left,c.sScale=Math.max(c.sWidth/b.innerWidth,c.sHeight/b.innerHeight)}d.style.webkitTransform="translate3d(0,0,0) scale("+c.sScale+")"},e._getScale=function(a,b){var c=a.width/b.width,d=a.height/b.height;return c<=d?a.height/(b.height*c):a.width/(b.width*d)},e._imgTransitionEnd=function(b){var c=b.target;c.classList.remove(a.className("transitioning")),c.removeEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this))},e._loadItem=function(b,c){var d=this.scroller.querySelector(a.classSelector(".slider-item:nth-child("+(b+1)+")")),e=this.currentGroup[b],f=d.querySelector("img");if(this._initImgData(e,f),c){var g=this._getPosition(e);f.style.webkitTransitionDuration="0ms",f.style.webkitTransform="translate3d("+g.x+"px,"+g.y+"px,0) scale("+e.sScale+")",f.offsetHeight}if(!e.loaded&&f.getAttribute("data-preview-lazyload")){var h=this;h.loader.classList.add(a.className("active")),f.style.webkitTransitionDuration="0.5s",f.addEventListener("webkitTransitionEnd",h._imgTransitionEnd.bind(h)),f.style.webkitTransform="translate3d(0,0,0) scale("+e.sScale+")",this.loadImage(f,function(){e.loaded=!0,f.src=e.lazyload,h._initZoom(d,this.width,this.height),f.classList.add(a.className("transitioning")),f.addEventListener("webkitTransitionEnd",h._imgTransitionEnd.bind(h)),f.setAttribute("style",""),f.offsetHeight,h.loader.classList.remove(a.className("active"))})}else e.lazyload&&(f.src=e.lazyload),this._initZoom(d,f.width,f.height),f.classList.add(a.className("transitioning")),f.addEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this)),f.setAttribute("style",""),f.offsetHeight;this._preloadItem(b+1),this._preloadItem(b-1)},e._preloadItem=function(b){var c=this.scroller.querySelector(a.classSelector(".slider-item:nth-child("+(b+1)+")"));if(c){var d=this.currentGroup[b];if(!d.sWidth){var e=c.querySelector("img");this._initImgData(d,e)}}},e._initZoom=function(b,c,d){if(this.options.zoom&&!b.getAttribute("data-zoomer"))if("IMG"===b.querySelector(a.classSelector(".zoom")).tagName){var e=this,f=e._getScale({width:b.offsetWidth,height:b.offsetHeight},{width:c,height:d});a(b).zoom({maxZoom:Math.max(f,1)})}else a(b).zoom()},e.loadImage=function(a,b){var c=function(){b&&b.call(this)},d=new Image;d.onload=c,d.onerror=c,d.src=a.getAttribute("data-preview-lazyload")},e.getRangeByIndex=function(a,b){return{from:0,to:b-1}},e._getPosition=function(a){var c=a.sLeft-b.pageXOffset,d=a.sTop-b.pageYOffset;return{left:c,top:d,x:c-(b.innerWidth-a.sWidth)/2,y:d-(b.innerHeight-a.sHeight)/2}},e.refresh=function(c,d){this.currentGroup=d;for(var e=d.length,f=[],g=this.getRangeByIndex(c,e),h=g.from,i=g.to+1,j=c,k="",l="",m=(b.innerWidth,b.innerHeight,0);h<i;h++,m++){var n=d[h],o="";n.sWidth&&(o="-webkit-transform:translate3d(0,0,0) scale("+n.sScale+");transform:translate3d(0,0,0) scale("+n.sScale+")"),l='<div class="mui-slider-item mui-zoom-wrapper {{className}}"><div class="mui-zoom-scroller"><img src="{{src}}" data-preview-lazyload="{{lazyload}}" style="{{style}}" class="mui-zoom"></div></div>'.replace("{{src}}",n.src).replace("{{lazyload}}",n.lazyload).replace("{{style}}",o),h===c?(j=m,k=a.className("active")):k="",f.push(l.replace("{{className}}",k))}this.scroller.innerHTML=f.join(""),this.element.style.display="block",this.element.classList.add(a.className("preview-in")),this.lastIndex=j,this.element.offsetHeight,a(this.element).slider().gotoItem(j,0),this.indicator&&(this.indicator.innerText=j+1+"/"+this.currentGroup.length),this._loadItem(j,!0)},e.openByGroup=function(a,b){a=Math.min(Math.max(0,a),this.groups[b].length-1),this.refresh(a,this.groups[b])},e.open=function(b,c){this.element.classList.contains(a.className("preview-in"))||("number"==typeof b?(c=c||"__DEFAULT",this.addImages(c,b),this.openByGroup(b,c)):(c=b.getAttribute("data-preview-group"),c=c||"__DEFAULT",this.addImages(c,b),this.openByGroup(this.groups[c].indexOf(b.__mui_img_data),c)))},e.close=function(c,d){this.element.classList.remove(a.className("preview-in")),this.element.classList.add(a.className("preview-out"));var e=this.scroller.querySelector(a.classSelector(".slider-item:nth-child("+(this.lastIndex+1)+")")),f=e.querySelector("img");if(f){f.classList.add(a.className("transitioning"));var g=this.currentGroup[this.lastIndex],h=this._getPosition(g),i=h.left,j=h.top;j>b.innerHeight||i>b.innerWidth||j<0||i<0?(f.style.opacity=0,f.style.webkitTransitionDuration="0.5s",f.style.webkitTransform="scale("+g.sScale+")"):(this.options.zoom&&a(f.parentNode.parentNode).zoom().toggleZoom(0),f.style.webkitTransitionDuration="0.5s",f.style.webkitTransform="translate3d("+h.x+"px,"+h.y+"px,0) scale("+g.sScale+")")}for(var k=this.element.querySelectorAll(a.classSelector(".zoom-wrapper")),l=0,m=k.length;l<m;l++)a(k[l]).zoom().destory()},e.isShown=function(){return this.element.classList.contains(a.className("preview-in"))};var f=null;a.previewImage=function(a){return f||(f=new d(a)),f},a.getPreviewImage=function(){return f}}(mui,window);